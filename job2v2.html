<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Jobs • Deep Edge (Dynamic Job Flow - Light Mode)</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <script src="header.js" defer></script>
  
  <style>
    :root {
      --bg: #f8f9fc;
      --card: #ffffff;
      --text: #1f2937;
      --muted: #6b7280;
      --accent: #7c3aed;
      --green: #10b981;
      --green-dark: #059669;
      --yellow: #d97706;
      --blue: #2563eb;
      --red: #dc2626;
      --border: #e5e7eb;
      --radius: 14px;
      --shadow: 0 4px 20px rgba(0,0,0,0.08);
      --modal-bg: rgba(0,0,0,0.65);
    }

    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: 'Manrope', system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding: 20px 16px;
      line-height: 1.45;
    }

    .container { max-width: 960px; margin: 0 auto; }

    .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 32px;
        margin-top: 60px;
        flex-wrap: wrap;
        gap: 16px;
    }

    h1 { font-size: 2.25rem; font-weight: 800; color: var(--accent); letter-spacing: -0.5px; }

    .btn-new {
      background: var(--accent);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 10px;
      font-weight: 600;
      font-size: 0.98rem;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(124,58,237,0.2);
    }

    .btn-new:hover { background: #6d28d9; transform: translateY(-1px); }

    .job-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 22px;
      margin-bottom: 32px;
      position: relative;
      box-shadow: var(--shadow);
      transition: all 0.3s ease;
    }

    .job-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 16px 40px rgba(124,58,237,0.15);
    }

    .job-address {
      font-size: 1.48rem;
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 6px;
    }

    .job-client {
      font-size: 1.08rem;
      color: var(--muted);
      margin-bottom: 14px;
    }

    .meta {
      display: flex;
      flex-wrap: wrap;
      gap: 16px 24px;
      margin-bottom: 16px;
      font-size: 0.94rem;
      color: var(--muted);
    }

    .status-badge {
      padding: 6px 14px;
      border-radius: 999px;
      font-weight: 600;
      font-size: 0.88rem;
    }

    .status-created   { background: #f3f4f6; color: #4b5563; }
    .status-quoted    { background: #ede9fe; color: #6d28d9; }
    .status-won       { background: #ecfdf5; color: #059669; }
    .status-progress  { background: #fffbeb; color: #d97706; }
    .status-completed { background: #f0fdf4; color: #059669; }
    .status-invoiced  { background: #eff6ff; color: #2563eb; }
    .status-paid      { background: #f0fdf4; color: #059669; }

    .last-activity { 
      font-style: normal; 
      color: #4b5563; 
      font-weight: 500;
    }

    .primary-action {
      display: block;
      width: 100%;
      max-width: 400px;
      margin: 24px auto;
      padding: 16px 20px;
      background: var(--green);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 1.14rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.25s;
      box-shadow: 0 5px 16px rgba(16,185,129,0.25);
    }

    .primary-action:hover {
      background: var(--green-dark);
      transform: translateY(-2px);
    }

    .overflow { 
      position: absolute; 
      top: 20px; 
      right: 20px; 
      font-size: 1.9rem; 
      color: var(--muted); 
      cursor: pointer; 
      user-select: none; 
      z-index: 5;
    }

    .menu {
      position: absolute;
      top: 50px;
      right: 0;
      background: white;
      border: 1px solid var(--border);
      border-radius: 12px;
      min-width: 240px;
      box-shadow: 0 12px 36px rgba(0,0,0,0.15);
      z-index: 10;
      display: none;
      overflow: hidden;
    }

    .menu.show { display: block; }

    .menu-section { padding: 6px 0; }

    .menu-item {
      padding: 12px 20px;
      cursor: pointer;
      transition: background 0.15s;
      color: var(--text);
      font-size: 0.95rem;
    }

    .menu-item:hover { background: #f3f4f6; }

    .menu-danger {
      color: var(--red);
      border-top: 1px solid var(--border);
    }

    .menu-danger:hover { background: #fee2e2; }

    .progress-bar {
      height: 6px;
      background: #e5e7eb;
      border-radius: 3px;
      margin: 18px 0 22px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: var(--accent);
      width: 0;
      transition: width 0.6s ease;
    }

    .notes-preview {
      margin-top: 16px;
      padding: 12px;
      background: #f9fafb;
      border-radius: 8px;
      font-size: 0.92rem;
      color: #4b5563;
      line-height: 1.4;
      cursor: pointer;
      border: 1px solid #e5e7eb;
    }

    .notes-preview:hover { background: #f3f4f6; }

    .modal-overlay {
      position: fixed;
      inset: 0;
      background: var(--modal-bg);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.25s;
    }

    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .modal-content {
      background: white;
      border-radius: 16px;
      width: 90%;
      max-width: 420px;
      padding: 28px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.25);
      transform: translateY(30px);
      transition: transform 0.3s;
    }

    .modal-overlay.active .modal-content {
      transform: translateY(0);
    }

    .modal-title {
      font-size: 1.4rem;
      font-weight: 700;
      margin-bottom: 20px;
      color: var(--text);
    }

    .modal-select, .modal-input {
      width: 100%;
      padding: 12px 16px;
      margin-bottom: 16px;
      border: 1px solid #d1d5db;
      border-radius: 10px;
      font-size: 1rem;
      background: #f9fafb;
    }

    .modal-buttons {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      margin-top: 20px;
    }

    .btn-modal {
      padding: 12px 24px;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      border: none;
    }

    .btn-cancel {
      background: #e5e7eb;
      color: #374151;
    }

    .btn-primary-modal {
      background: var(--green);
      color: white;
    }

    .btn-send {
      background: var(--accent);
      color: white;
      flex: 1;
    }

    .send-options {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 16px;
    }

    @media (max-width: 500px) {
      .primary-action { font-size: 1.04rem; padding: 14px 18px; }
      .job-address { font-size: 1.32rem; }
      .modal-content { padding: 24px; }
      .menu { min-width: 200px; right: 10px; }
    }

    /* New styles for added elements */
    h2 { font-size: 1.75rem; font-weight: 700; margin-bottom: 20px; color: var(--text); }

    .today-previews {
  display: flex;
  flex-direction: column;        /* ← stack vertically, one under the other */
  gap: 16px;                     /* space between cards */
  margin-bottom: 48px;
}

.mini-card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 18px 22px;            /* match job-card padding more closely */
  box-shadow: var(--shadow);
  transition: all 0.3s ease;

  /* Make it full width like job-card */
  width: 100%;                   /* ← key: full width of container */
  max-width: 960px;              /* same as container max-width */
  margin: 0 auto;                /* center if needed */

  /* Optional: make them look slimmer / preview-like */
  min-height: 110px;             /* or remove if you want natural height */
}

    .mini-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 24px rgba(124,58,237,0.1);
    }

    .mini-address {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 4px;
    }

    .mini-client {
      font-size: 0.85rem;
      color: var(--muted);
      margin-bottom: 8px;
    }

    .mini-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.8rem;
      color: var(--muted);
    }

    .mini-status {
      padding: 4px 10px;
      border-radius: 999px;
      font-weight: 600;
      font-size: 0.75rem;
    }

    .calendar {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
      margin-bottom: 48px;
      box-shadow: var(--shadow);
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
    }

    .calendar-day {
      padding: 12px;
      text-align: center;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 0.9rem;
    }

    .calendar-day.header {
      font-weight: 600;
      background: #f3f4f6;
    }

    .calendar-amount {
      display: block;
      margin-top: 4px;
      color: var(--green);
      font-weight: 600;
    }

    .all-jobs {
      margin-bottom: 48px;
    }
  </style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1>Your Jobs</h1>
    <button class="btn-new">+ New Job</button>
  </div>

  <h2>Today</h2>
  <div class="today-previews">
    <div class="mini-card">
      <div class="mini-address">40 Griffen Park Road, Mount Roskill</div>
      <div class="mini-client">Smith Family • 9:00 AM</div>
      <div class="mini-meta">
        <span class="mini-status status-progress">In Progress</span>
        <span>$85 due</span>
      </div>
    </div>
    <div class="mini-card">
      <div class="mini-address">15 Oak Street, Epsom</div>
      <div class="mini-client">Johnson Residence • 11:30 AM</div>
      <div class="mini-meta">
        <span class="mini-status status-won">Job Won</span>
        <span>$120 due</span>
      </div>
    </div>
    <div class="mini-card">
      <div class="mini-address">22 Pine Avenue, Remuera</div>
      <div class="mini-client">Lee Family • 2:00 PM</div>
      <div class="mini-meta">
        <span class="mini-status status-completed">Completed</span>
        <span>$95 due</span>
      </div>
    </div>
  </div>

  <h2>Calendar</h2>
  <div class="calendar">
    <div class="calendar-grid">
      <div class="calendar-day header">Sun</div>
      <div class="calendar-day header">Mon</div>
      <div class="calendar-day header">Tue</div>
      <div class="calendar-day header">Wed</div>
      <div class="calendar-day header">Thu</div>
      <div class="calendar-day header">Fri</div>
      <div class="calendar-day header">Sat</div>
      <!-- Mock January 2026 (starts on Thu) -->
      <div class="calendar-day"></div>
      <div class="calendar-day"></div>
      <div class="calendar-day"></div>
      <div class="calendar-day">1<span class="calendar-amount">$0</span></div>
      <div class="calendar-day">2<span class="calendar-amount">$150</span></div>
      <div class="calendar-day">3<span class="calendar-amount">$200</span></div>
      <div class="calendar-day">4<span class="calendar-amount">$0</span></div>
      <div class="calendar-day">5<span class="calendar-amount">$0</span></div>
      <div class="calendar-day">6<span class="calendar-amount">$85</span></div>
      <div class="calendar-day">7<span class="calendar-amount">$120</span></div>
      <div class="calendar-day">8<span class="calendar-amount">$0</span></div>
      <div class="calendar-day">9<span class="calendar-amount">$95</span></div>
      <div class="calendar-day">10<span class="calendar-amount">$180</span></div>
      <div class="calendar-day">11<span class="calendar-amount">$0</span></div>
      <div class="calendar-day">12<span class="calendar-amount">$0</span></div>
      <div class="calendar-day">13<span class="calendar-amount">$210</span></div>
      <div class="calendar-day">14<span class="calendar-amount">$140</span></div>
      <div class="calendar-day">15<span class="calendar-amount">$0</span></div>
      <div class="calendar-day">16<span class="calendar-amount">$100</span></div>
      <div class="calendar-day">17<span class="calendar-amount">$0</span></div>
      <div class="calendar-day">18<span class="calendar-amount">$0</span></div>
      <div class="calendar-day">19<span class="calendar-amount">$0</span></div>
      <div class="calendar-day">20<span class="calendar-amount">$300</span></div>
      <div class="calendar-day">21<span class="calendar-amount">$250</span></div>
      <div class="calendar-day">22<span class="calendar-amount">$0</span></div>
      <div class="calendar-day">23<span class="calendar-amount">$110</span></div>
      <div class="calendar-day">24<span class="calendar-amount">$0</span></div>
      <div class="calendar-day">25<span class="calendar-amount">$0</span></div>
      <div class="calendar-day">26<span class="calendar-amount">$0</span></div>
      <div class="calendar-day">27<span class="calendar-amount">$160</span></div>
      <div class="calendar-day">28<span class="calendar-amount">$190</span></div>
      <div class="calendar-day">29<span class="calendar-amount">$0</span></div>
      <div class="calendar-day">30<span class="calendar-amount">$220</span></div>
      <div class="calendar-day">31<span class="calendar-amount">$0</span></div>
    </div>
  </div>

  <h2>All Jobs</h2>
  <div class="all-jobs">
    <div class="job-card" data-stage="created">
      <div class="overflow">⋯</div>
      <div class="menu"></div>

      <div class="job-address">40 Griffen Park Road, Mount Roskill</div>
      <div class="job-client">Smith Family • 021 555 1234 • Gate: 2232</div>

      <div class="meta">
        <span class="status-badge">Quote Created</span>
        <span class="last-activity">Last activity: Quote created</span>
      </div>

      <div class="progress-bar">
        <div class="progress-fill"></div>
      </div>

      <button class="primary-action">Send Quote</button>

      <div class="notes-preview">
        Client requested fortnightly service. Prefers Tuesday mornings. Avoid rose bushes.
      </div>
    </div>
    <div class="job-card" data-stage="quoted">
      <div class="overflow">⋯</div>
      <div class="menu"></div>

      <div class="job-address">15 Oak Street, Epsom</div>
      <div class="job-client">Johnson Residence • 021 666 5678 • Gate: 3344</div>

      <div class="meta">
        <span class="status-badge">Quote Sent</span>
        <span class="last-activity">Last activity: Quote sent to client</span>
      </div>

      <div class="progress-bar">
        <div class="progress-fill"></div>
      </div>

      <button class="primary-action">Schedule Service</button>

      <div class="notes-preview">
        Weekly mowing requested. Saturday afternoons preferred.
      </div>
    </div>
    <div class="job-card" data-stage="won">
      <div class="overflow">⋯</div>
      <div class="menu"></div>

      <div class="job-address">22 Pine Avenue, Remuera</div>
      <div class="job-client">Lee Family • 021 777 9012 • Gate: 4455</div>

      <div class="meta">
        <span class="status-badge">Job Won</span>
        <span class="last-activity">Last activity: Job accepted by client</span>
      </div>

      <div class="progress-bar">
        <div class="progress-fill"></div>
      </div>

      <button class="primary-action">Start Job</button>

      <div class="notes-preview">
        One-off service. Trim hedges carefully.
      </div>
    </div>
    <div class="job-card" data-stage="progress">
      <div class="overflow">⋯</div>
      <div class="menu"></div>

      <div class="job-address">8 Maple Lane, Onehunga</div>
      <div class="job-client">Brown Household • 021 888 3456 • Gate: 5566</div>

      <div class="meta">
        <span class="status-badge">In Progress</span>
        <span class="last-activity">Last activity: Service started on site</span>
      </div>

      <div class="progress-bar">
        <div class="progress-fill"></div>
      </div>

      <button class="primary-action">Complete Job</button>

      <div class="notes-preview">
        Monthly maintenance. Check for weeds.
      </div>
    </div>
    <div class="job-card" data-stage="completed">
      <div class="overflow">⋯</div>
      <div class="menu"></div>

      <div class="job-address">33 Birch Road, Ponsonby</div>
      <div class="job-client">Wilson Family • 021 999 7890 • Gate: 6677</div>

      <div class="meta">
        <span class="status-badge">Completed</span>
        <span class="last-activity">Last activity: Job completed</span>
      </div>

      <div class="progress-bar">
        <div class="progress-fill"></div>
      </div>

      <button class="primary-action">Create Invoice</button>

      <div class="notes-preview">
        Fortnightly. Fertilizer applied.
      </div>
    </div>
    <div class="job-card" data-stage="invoiced">
      <div class="overflow">⋯</div>
      <div class="menu"></div>

      <div class="job-address">47 Elm Street, Grey Lynn</div>
      <div class="job-client">Taylor Residence • 021 111 2345 • Gate: 7788</div>

      <div class="meta">
        <span class="status-badge">Invoiced</span>
        <span class="last-activity">Last activity: Invoice sent</span>
      </div>

      <div class="progress-bar">
        <div class="progress-fill"></div>
      </div>

      <button class="primary-action">Mark Paid</button>

      <div class="notes-preview">
        Weekly. No issues reported.
      </div>
    </div>
    <div class="job-card" data-stage="paid">
      <div class="overflow">⋯</div>
      <div class="menu"></div>

      <div class="job-address">19 Cedar Drive, Herne Bay</div>
      <div class="job-client">Martinez Family • 021 222 6789 • Gate: 8899</div>

      <div class="meta">
        <span class="status-badge">Paid ✓</span>
        <span class="last-activity">Last activity: Payment received</span>
      </div>

      <div class="progress-bar">
        <div class="progress-fill"></div>
      </div>

      <button class="primary-action">Schedule Next Visit</button>

      <div class="notes-preview">
        Monthly. Client satisfied.
      </div>
    </div>
  </div>

</div>

<div id="modalOverlay" class="modal-overlay">
  <div class="modal-content" id="modalContent"></div>
</div>

<script>
/* ✅ REQUIRED: mockQuotes (minimal necessary fix) */
const mockQuotes = [
  { id: 'Q-1021', date: '2026-01-10', total: 285.50 },
  { id: 'Q-1018', date: '2025-12-22', total: 260.00 },
  { id: 'Q-1012', date: '2025-11-30', total: 240.75 }
];

// Full lifecycle
const STAGES = [
  {
    id: 'created',
    label: 'Quote Created',
    color: 'status-created',
    progress: 14.29,
    primary: 'Send Quote',
    lastActivity: 'Quote created',
    menuQuick: ['Edit Quote', 'Add Note', 'View Details'],
    menuDanger: ['Delete Quote']
  },
  {
    id: 'quoted',
    label: 'Quote Sent',
    color: 'status-quoted',
    progress: 28.57,
    primary: 'Schedule Service',
    lastActivity: 'Quote sent to client',
    menuQuick: ['Resend Quote', 'Send Reminder', 'Add Note'],
    menuManage: ['Edit Quote', 'Change Price'],
    menuDanger: ['Cancel Job']
  },
  {
    id: 'won',
    label: 'Job Won',
    color: 'status-won',
    progress: 42.86,
    primary: 'Start Job',
    lastActivity: 'Job accepted by client',
    menuQuick: ['Schedule Visit', 'Add Note', 'View Details'],
    menuManage: ['Change Frequency', 'Adjust Price'],
    menuDanger: ['Cancel Service']
  },
  {
    id: 'progress',
    label: 'In Progress',
    color: 'status-progress',
    progress: 57.14,
    primary: 'Complete Job',
    lastActivity: 'Service started on site',
    menuQuick: ['Add Photo', 'Add Note', 'Skip Visit'],
    menuManage: ['Adjust Price', 'Change Frequency'],
    menuDanger: ['Cancel Service']
  },
  {
    id: 'completed',
    label: 'Completed',
    color: 'status-completed',
    progress: 71.43,
    primary: 'Create Invoice',
    lastActivity: 'Job completed',
    menuQuick: ['View Details', 'Add Final Note'],
    menuManage: ['Adjust Final Price'],
    menuDanger: ['Reopen Job']
  },
  {
    id: 'invoiced',
    label: 'Invoiced',
    color: 'status-invoiced',
    progress: 85.71,
    primary: 'Mark Paid',
    lastActivity: 'Invoice sent',
    menuQuick: ['Send Reminder', 'View Invoice'],
    menuManage: ['Edit Invoice'],
    menuDanger: ['Void Invoice']
  },
  {
    id: 'paid',
    label: 'Paid ✓',
    color: 'status-paid',
    progress: 100,
    primary: 'Schedule Next Visit',
    lastActivity: 'Payment received',
    menuQuick: ['Send Receipt', 'View History'],
    menuDanger: ['Archive Client']
  }
];

function getStageConfig(stageId) {
  return STAGES.find(s => s.id === stageId) || STAGES[0];
}

function updateCard(card) {
  const stage = card.dataset.stage;
  const config = getStageConfig(stage);

  card.querySelector('.status-badge').textContent = config.label;
  card.querySelector('.status-badge').className = `status-badge ${config.color}`;
  card.querySelector('.last-activity').textContent = `Last activity: ${config.lastActivity}`;
  card.querySelector('.progress-fill').style.width = `${config.progress}%`;
  card.querySelector('.primary-action').textContent = config.primary;

  const menu = card.querySelector('.menu');
  menu.innerHTML = '';

  if (config.menuQuick?.length) {
    const section = document.createElement('div');
    section.className = 'menu-section';
    config.menuQuick.forEach(text => {
      const item = document.createElement('div');
      item.className = 'menu-item';
      item.textContent = text;
      section.appendChild(item);
    });
    menu.appendChild(section);
  }

  if (config.menuManage?.length) {
    const section = document.createElement('div');
    section.className = 'menu-section';
    config.menuManage.forEach(text => {
      const item = document.createElement('div');
      item.className = 'menu-item';
      item.textContent = text;
      section.appendChild(item);
    });
    menu.appendChild(section);
  }

  if (config.menuDanger?.length) {
    const danger = document.createElement('div');
    danger.className = 'menu-section menu-danger';
    config.menuDanger.forEach(text => {
      const item = document.createElement('div');
      item.className = 'menu-item';
      item.textContent = text;
      danger.appendChild(item);
    });
    menu.appendChild(danger);
  }
}

function showModal(contentHTML) {
  const overlay = document.getElementById('modalOverlay');
  const content = document.getElementById('modalContent');
  content.innerHTML = contentHTML;
  overlay.classList.add('active');
}

function closeModal() {
  document.getElementById('modalOverlay').classList.remove('active');
}

function advanceStage(card) {
  const current = card.dataset.stage;
  const idx = STAGES.findIndex(s => s.id === current);
  const nextIdx = (idx + 1) % STAGES.length;
  card.dataset.stage = STAGES[nextIdx].id;

  card.style.opacity = '0.65';
  card.style.transform = 'scale(0.98)';
  setTimeout(() => {
    updateCard(card);
    card.style.opacity = '1';
    card.style.transform = 'scale(1)';
  }, 220);
}

document.addEventListener('DOMContentLoaded', () => {
  const cards = document.querySelectorAll('.job-card');
  cards.forEach(card => {
    updateCard(card);

    card.querySelector('.primary-action').addEventListener('click', () => {
      const stage = card.dataset.stage;

      if (stage === 'created') {
        showModal(`
          <h2 class="modal-title">Send Quote</h2>
          <p style="margin-bottom:20px; color:#4b5563;">Choose how to send the quote to the client:</p>
          <div class="send-options">
            <button class="btn-modal btn-primary-modal btn-send" onclick="closeModal(); advanceStage(document.querySelector('[data-stage=${card.dataset.stage}]'));">Email</button>
            <button class="btn-modal btn-primary-modal btn-send" onclick="closeModal(); advanceStage(document.querySelector('[data-stage=${card.dataset.stage}]'));">SMS</button>
            <button class="btn-modal btn-primary-modal btn-send" onclick="closeModal(); advanceStage(document.querySelector('[data-stage=${card.dataset.stage}]'));">Copy to Clipboard</button>
          </div>
          <div class="modal-buttons" style="margin-top:24px;">
            <button class="btn-modal btn-cancel" onclick="closeModal()">Cancel</button>
          </div>
        `);
      } else if (stage === 'quoted') {
        showModal(`
          <h2 class="modal-title">Schedule Service</h2>
          <label style="display:block; margin-bottom:8px; font-weight:600;">Frequency</label>
          <select class="modal-select">
            <option>One-off</option>
            <option>Weekly</option>
            <option selected>Fortnightly</option>
            <option>Monthly</option>
          </select>
          <label style="display:block; margin:16px 0 8px; font-weight:600;">Start Date</label>
          <input type="date" class="modal-input" value="2026-01-28">
          <div class="modal-buttons">
            <button class="btn-modal btn-cancel" onclick="closeModal()">Cancel</button>
            <button class="btn-modal btn-primary-modal" onclick="closeModal(); advanceStage(document.querySelector('[data-stage=${card.dataset.stage}]'));">Confirm Schedule</button>
          </div>
        `);
      } else if (stage === 'won') {
        showModal(`
          <h2 class="modal-title">Confirm On Site</h2>
          <div class="modal-buttons">
            <button class="btn-modal btn-cancel" onclick="closeModal()">No</button>
            <button class="btn-modal btn-primary-modal" onclick="closeModal(); advanceStage(document.querySelector('[data-stage=${card.dataset.stage}]'));">Yes – Start Job</button>
          </div>
        `);
      } else if (stage === 'completed') {
        showModal(`
          <div id="invoiceStep1">
            <h2 class="modal-title">Create Invoice</h2>
            <label style="display:block; margin-bottom:8px; font-weight:600;">Base invoice on:</label>
            <select class="modal-select">
              ${mockQuotes.map(q => `<option>${q.id} - ${q.date} - $${q.total.toFixed(2)}</option>`).join('')}
            </select>
            <div class="modal-buttons">
              <button class="btn-modal btn-cancel" onclick="closeModal()">Cancel</button>
              <button class="btn-modal btn-primary-modal" onclick="document.getElementById('invoiceStep1').style.display='none'; document.getElementById('invoiceStep2').style.display='block';">Next →</button>
            </div>
          </div>
          <div id="invoiceStep2" style="display:none;">
            <h2 class="modal-title">Send Invoice</h2>
            <div class="send-options">
              <button class="btn-modal btn-primary-modal btn-send" onclick="closeModal(); advanceStage(document.querySelector('[data-stage=${card.dataset.stage}]'));">Email</button>
              <button class="btn-modal btn-primary-modal btn-send" onclick="closeModal(); advanceStage(document.querySelector('[data-stage=${card.dataset.stage}]'));">SMS</button>
              <button class="btn-modal btn-primary-modal btn-send" onclick="closeModal(); advanceStage(document.querySelector('[data-stage=${card.dataset.stage}]'));">Copy to Clipboard</button>
            </div>
          </div>
        `);
      } else if (stage === 'invoiced') {
        showModal(`
          <h2 class="modal-title">Mark as Paid</h2>
          <select class="modal-select">
            <option>Cash</option>
            <option selected>Digital</option>
            <option>Credit Card</option>
          </select>
          <input type="number" class="modal-input" value="285.50">
          <div class="modal-buttons">
            <button class="btn-modal btn-cancel" onclick="closeModal()">Cancel</button>
            <button class="btn-modal btn-primary-modal" onclick="closeModal(); advanceStage(document.querySelector('[data-stage=${card.dataset.stage}]'));">Confirm Payment</button>
          </div>
        `);
      } else {
        advanceStage(card);
      }
    });

    const overflow = card.querySelector('.overflow');
    const menu = card.querySelector('.menu');
    overflow.addEventListener('click', e => {
      e.stopPropagation();
      menu.classList.toggle('show');
    });
    document.addEventListener('click', () => menu.classList.remove('show'));
  });

  document.getElementById('modalOverlay').addEventListener('click', e => {
    if (e.target === e.currentTarget) closeModal();
  });

  // Apply status colors to mini statuses
  const miniStatuses = document.querySelectorAll('.mini-status');
  miniStatuses.forEach(status => {
    const text = status.textContent.toLowerCase().replace(' ', '-');
    status.classList.add(`status-${text}`);
  });
});
</script>
</body>
</html>